<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login - Movie Review Platform</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',sans-serif;background:#121212;color:#eee;overflow-x:hidden;}
html{scroll-behavior:smooth;}
header{position:fixed;top:0;left:0;width:100%;display:flex;justify-content:space-between;align-items:center;
padding:15px 50px;z-index:1000;background:rgba(0,0,0,0.8);backdrop-filter:blur(8px);box-shadow:0 2px 10px rgba(0,0,0,0.5);}
header h1{color:#e50914;font-size:26px;font-weight:700;letter-spacing:1px;text-shadow:0 0 5px rgba(229,9,20,0.5);}
nav a{color:#eee;text-decoration:none;margin-left:30px;font-weight:500;transition:.4s;position:relative;padding:5px 0;}
nav a::after{content:'';position:absolute;left:0;bottom:0;width:0;height:2px;background:#e50914;transition:width .4s;}
nav a:hover{color:#e50914;}
nav a:hover::after{width:100%;}
.login-section{height:100vh;display:flex;justify-content:center;align-items:center;text-align:center;position:relative;}
.login-form-wrapper{background:#1e1e1e;padding:50px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,0.7);width:380px;opacity:0;transform:translateY(20px);transition:.8s;}
.login-form-wrapper.show{opacity:1;transform:translateY(0);}
.login-form h2{color:#e50914;margin-bottom:30px;font-size:32px;text-align:center;}
.login-form input{width:100%;padding:15px;margin-bottom:20px;border:1px solid #555;border-radius:10px;background:#121212;color:#eee;font-size:17px;transition:.3s;}
.login-form input:focus{border-color:#e50914;box-shadow:0 0 8px rgba(229,9,20,0.3);outline:none;}
.login-form button{width:100%;padding:15px;border:none;border-radius:10px;background:#e50914;color:#121212;font-size:19px;cursor:pointer;transition:.4s;font-weight:600;}
.login-form button:hover{background:#b20710;transform:translateY(-3px);box-shadow:0 6px 15px rgba(229,9,20,0.4);}
.login-form .redirect{margin-top:15px;color:#ccc;font-size:15px;}
.login-form .redirect a{color:#e50914;text-decoration:none;margin-left:5px;transition:.3s;}
.login-form .redirect a:hover{color:#b20710;}
.toast { position: fixed; bottom: 20px; right: 20px; background: #333; color: #fff; padding: 1rem 1.5rem; border-radius: 5px; display: none; z-index: 2000; }
.toast.success { background: green; }
.toast.error { background: red; }
@media(max-width:576px){header{padding:10px 20px;}header h1{font-size:20px}.login-form-wrapper{width:90%;padding:30px;}}
</style>
</head>
<body>
<header>
  <h1>MovieReview</h1>
  <nav>
    <a href="index.html">Home</a>
  </nav>
</header>

<section class="login-section">
  <div class="login-form-wrapper" id="loginFormWrapper">
    <form class="login-form" id="loginForm">
      <h2>Login</h2>
      <input type="email" name="email" placeholder="Email Address" required/>
      <input type="password" name="password" placeholder="Password" required/>
      <button type="submit">Login</button>
      <div class="redirect">Don't have an account? <a href="signup.html">Sign Up</a></div>
    </form>
  </div>
</section>

<div id="toast" class="toast"></div>
<script>
  const API_BASE = "http://localhost:5000/api";

window.addEventListener('load', () => {
  const wrapper = document.getElementById('loginFormWrapper');
  setTimeout(() => { wrapper.classList.add('show'); }, 300);
});

function showToast(msg, type="info") {
  const toast = document.getElementById("toast");
  toast.textContent = msg;
  toast.className = "toast " + type;
  toast.style.display = "block";
  setTimeout(() => { toast.style.display = "none"; }, 3000);
}

document.getElementById("loginForm").addEventListener("submit", async function(e){
  e.preventDefault();

  const email = this.email.value.trim().toLowerCase();
  const password = this.password.value;

  if(!email || !password){
    showToast("All fields are required ❌", "error");
    return;
  }

  try {
    const res = await fetch(`${API_BASE}/auth/login`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password })
    });

    const data = await res.json();
    console.log("Login response:", data); // ✅ debug

if(res.ok && data.token){
  // Store token and user info first
  localStorage.setItem("token", data.token);

  showToast("Login successful ✅", "success");

  // Redirect to dashboard, not profile
  setTimeout(() => { window.location.href = "dashboard.html"; }, 500);
}
 else {
      showToast(data.error || "Login failed ❌", "error");
    }

  } catch(err) {
    console.error(err);
    showToast("Login failed ❌", "error");
  }
});

</script>
</body>
</html>
